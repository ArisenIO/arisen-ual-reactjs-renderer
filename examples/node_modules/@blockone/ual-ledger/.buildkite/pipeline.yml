steps:
  - command: |
      .buildkite/scripts/security.sh
    label: ":nodesecurity: Security"
    skip: "Skipping since it keeps failing"
    agents:
      queue: "automation-standard-builder-fleet"
    plugins:
      docker#v1.1.1:
        image: "node:10"
        workdir: /data/job
        environment:
          - NPM_AUTH_TOKEN

  - command: |
      .buildkite/scripts/lint.sh
    label: ":eslint: Linting"
    agents:
      queue: "automation-standard-builder-fleet"
    artifact_paths:
      - "out/**/*"
    plugins:
      docker#v1.1.1:
        image: "node:10"
        workdir: /data/job
        environment:
          - NPM_AUTH_TOKEN

  - command: |
      .buildkite/scripts/build.sh
    label: ":spiral_note_pad: Run Build"
    agents:
      queue: "automation-standard-builder-fleet"
    plugins:
      docker#v1.1.1:
        image: "node:10"
        workdir: /data/job
        environment:
          - CI=true
          - NPM_AUTH_TOKEN

  - command: |
      .buildkite/scripts/tests.sh
    label: ":spiral_note_pad: Run Tests"
    agents:
      queue: "automation-standard-builder-fleet"
    plugins:
      docker#v1.1.1:
        image: "node:10"
        workdir: /data/job
        environment:
          - CI=true
          - NPM_AUTH_TOKEN

  - wait

  - command: |
      node .buildkite/scripts/publish.sh
    label: "Publishing edge"
    agents:
      queue: "automation-standard-builder-fleet"
    branches: "develop"
  
  - command: |
      echo "Success!!"
    agents:
      queue: "automation-standard-builder-fleet"
    label: "All checks succeeded :partyparrot:"
